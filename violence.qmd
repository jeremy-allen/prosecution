---
author: Jeremy Allen
format: html
code-fold: true
---

# Political Violence
This analysis uses data from The Prosecution Project Dataset (Loadenthal et al. 2023) to examine the number of prosecutions in the United States for violent crimes across ideological affiliations. The dataset includes information on various criminal methods, ideological affiliations, and prosecution details.

```{r}
#| message: false
#| warning: false

suppressPackageStartupMessages({
    library(tidyverse)
    library(janitor)
    library(RColorBrewer)
})
```

## Prepare the data

Import the data, clean the column names, and remove pending cases and cases without clear guilty verdict, filter for only the US.
```{r}
#| message: false
#| warning: false
df <- read_csv("data/tpp-2025-09-15-general.csv") |> 
    clean_names()

# fix the mix of numeric and character in the # killed coloumn
df <- df |> 
    mutate(
    number_killed = case_when(
      number_killed %in% c("Multiple", "Unknown") ~ NA_real_,  # Convert text to NA
      is.na(number_killed) ~ NA_real_,  # Keep existing NAs
      TRUE ~ number_killed  # Keep numeric values as they are
    )
  )

no_clear_guilt <- c("Charged but not tried", "Data not available", "Not guilty", "Hung jury/mistrial", "Pending")
num_no_clear_guilt <- df |> 
    filter(verdict %in% no_clear_guilt) |> 
    nrow()

df <- df |> 
    filter(!verdict %in% no_clear_guilt)

df <- df |> 
    filter(location_country == "United States")
```

There were *`r num_no_clear_guilt`* cases without a clear guilty verdict that were removed from the analysis.

How many cases are not linked or motivated politically?
```{r}
#| message: false
#| warning: false
total_cases <- nrow(df)

cases_not_political <- df |>
    filter(criminal_method == "Criminal violation not linked or motivated politically") |> 
    nrow()
```

There were *`r cases_not_political`* cases not politically motivated out of a total of *`r total_cases` cases*, which is *`r round((cases_not_political / total_cases) * 100, 2)`%*. So, we will exclude the non-politically motivated cases going forward.

```{r}
#| message: false
#| warning: false

# remove cases not politically motivated or unknown
df <- df |>
    filter(!criminal_method %in% c("Unknown/unspecified/undeveloped", "Criminal violation not linked or motivated politically"))

# parse dates
df <- df |> 
    mutate(
        date = str_trim(date),
        date = lubridate::mdy(date)
    )

```

Which dates are represented in the data?
```{r}
#| message: false
#| warning: true

# Warn if minimum date is earlier than 1900 or latest date is later than today
date_range <- range(df$date, na.rm = TRUE)
if (date_range[1] < as.Date("1900-01-01") || date_range[2] > Sys.Date()) {
    warning("Date range is outside expected bounds.")
}


df |>
    summarise(
        `Earliest Date` = min(date, na.rm = TRUE),
        `Latest Date` = max(date, na.rm = TRUE)
    ) |> 
    knitr::kable()
```

### Which ideological affiliations are represented in the data?
```{r}
#| message: false
#| warning: false
df |>
    count(ideological_affiliation) |> 
    knitr::kable()
```

### Simplify ideologies
Because there are multiple leftist categories and multiple rightist categories, lets add a column that consolidates leftist types and rightest types.
```{r}
#| message: false
#| warning: false
df <- df |> 
    mutate(
        ideology_simple = case_when(
            str_detect(ideological_affiliation, "Leftist") ~ "Leftist",
            str_detect(ideological_affiliation, "Rightist") ~ "Rightist",
            TRUE ~ ideological_affiliation
        )
    )

df |>
    count(ideology_simple, sort = TRUE) |> 
    knitr::kable()
```

# Focus on Violence

### How many prosecutions were for violent vs. non-violent methods, by ideological affiliation?
Then let's filter for only those to make our visualizations.
```{r}
#| message: false
#| warning: false

# classify methods as violent or non-violent
violent <- c(
  "Unarmed assault",
  "Hostage-taking",
  "Armed intimidation/standoff",
  "Vehicle ramming",
  "Chemical or biological weapon deployment",
  "Firearms: civilian",
  "Firearms: military",
  "Explosives",
  "Other weapons"
)

df <- df |> 
    mutate(method_type = if_else(
        criminal_method %in% violent,
        "violent",
        "non-violent"
    ))

df |> 
    group_by(ideology_simple, method_type) |> 
    summarise(n = n()) |> 
    pivot_wider(names_from = method_type, values_from = n, values_fill = 0) |>
    select(ideology_simple, violent, `non-violent`) |>
    arrange(desc(violent)) |> 
    knitr::kable()

```

## Prosections for violent crimes in the US by ideological affiliation
```{r}
#| message: false
#| warning: false
#| fig-width: 12

violent_crimes <- df |> 
    filter(
        method_type == "violent",
        ideology_simple != "No affiliation/not a factor"
        )
    
violent_crimes_by_ideology <- violent_crimes |> 
    count(ideology_simple, name = "violent_prosecutions") |> 
    arrange(desc(violent_prosecutions))

ggplot(violent_crimes_by_ideology, aes(x = reorder(ideology_simple, violent_prosecutions), 
                                       y = violent_prosecutions)) +
    geom_col(fill = "black", alpha = 0.8) +
    coord_flip() +
    labs(
        title = "Prosecutions for Violent Crimes in the US",
        subtitle = "Based on The Prosecution Project Dataset",
        x = "Ideological Affiliation",
        y = "Number of Prosecutions for Violent Crimes",
        caption = "Source: The Prosecution Project"
    ) +
    theme_minimal() +
    theme(
        plot.title = element_text(size = 14, face = "bold"),
        plot.subtitle = element_text(size = 12),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 11)
    )
```

## Prosecutions for violent crimes in the US by ideological affiliation by year
```{r}
#| message: false
#| warning: false
#| fig-width: 14
#| column: page

df_yearly <- violent_crimes |>
    mutate(
        year = lubridate::year(date),
        year = as.integer(year)
    ) |>
    filter(!is.na(year)) |>
    count(year, ideology_simple, name = "prosecutions")

ggplot(df_yearly, aes(x = year, y = prosecutions, fill = ideology_simple)) +
    geom_col() +
    scale_fill_manual(values = c(
        "Rightist" = "#c14a58ff",                    # Red for Rightist
        "Leftist" = "#337fb5ff",                     # Blue for Leftist  
        "Salafi/Jihadist/Islamist" = "#e08738ff",    # Orange
        "Unclear" = "#71a771ff",                     # Green
        "Nationalist-separatist" = "#8c564b",      # Brown
        "Other" = "#e377c2"                        # Pink
    )) +
    scale_x_continuous(breaks = scales::pretty_breaks(n = 8)) +
    labs(
        title = "Total Prosecutions of Violent Crimes in the US by Year",
        subtitle = "By Ideological Affiliation",
        x = "Year",
        y = "Number of Prosecutions",
        fill = "Ideological Affiliation",
        caption = "Source: The Prosecution Project"
    ) +
    guides(fill = guide_legend(ncol = 1)) +
    theme_minimal() +
    theme(
        plot.title = element_text(size = 14, face = "bold"),
        plot.subtitle = element_text(size = 12),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 11),
        legend.position = "right",
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 9)
    )
```

```{r}
#| message: false
#| warning: false
#| fig-width: 12

# Don't double count deaths in cases where more than one person is tried for the same incident
df_deaths <- violent_crimes |>
  mutate(
    # Extract the incident date from Case ID (first part before underscore)  
    incident_date = str_extract(case_id, "^[^_]+"),
    # Parse the date correctly
    incident_date_formatted = case_when(
      str_length(incident_date) == 8 & str_detect(incident_date, "^\\d{8}$") ~ 
        paste0(str_sub(incident_date, 1, 2), "/", 
               str_sub(incident_date, 3, 4), "/", 
               str_sub(incident_date, 5, 8)),
      TRUE ~ incident_date
    )
  ) |>
  group_by(incident_date, incident_date_formatted) |>
  summarise(
    unique_incidents = 1,  
    related_cases = n(),   
    total_individuals = n_distinct(full_legal_name), 
    total_deaths = first(number_killed, na_rm = TRUE),  
    case_names = paste(unique(name_of_case), collapse = "; "),
    ideology_simple = first(ideology_simple, na_rm = TRUE),
    .groups = "drop"
  ) |>
  group_by(ideology_simple) |> 
  summarise(total_deaths = sum(total_deaths, na.rm = TRUE)) |> 
  arrange(desc(total_deaths))

plot1 <- ggplot(df_deaths, aes(x = reorder(ideology_simple, total_deaths), 
                                       y = total_deaths)) +
    geom_col(fill = "black", alpha = 0.8) +
    coord_flip() +
    labs(
        title = "Deaths from Violent Crimes Prosecuted in the US",
        subtitle = "By Ideological Affiliation",
        x = "Ideological Affiliation",
        y = "Deaths",
        caption = "Source: The Prosecution Project"
    ) +
    theme_minimal() +
    theme(
        plot.title = element_text(size = 14, face = "bold"),
        plot.subtitle = element_text(size = 12),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 11)
    )

plot1

```


## References

Loadenthal, Michael, Lauren Donahoe, Madison Weaver, Sara Godfrey, Kathryn Blowers, et. al. “The Prosecution Project Dataset,” the Prosecution Project, 2023 [dataset]. https://theprosecutionproject.org/

## Code
This descriptive analysis was created by Jeremy Allen using R, tidyverse, janitor, and RColorBrewer packages. The report is built with Quarto. The code is available on [GitHub](https://github.com/jeremy-allen/prosecution.git).
